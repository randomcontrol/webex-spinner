var t,s;t=this,s=function(){const t={preload_amount:0,poster:!1,fps:30,loop:!0,autoplay:!0,reverse:!1,nx:4,ny:1,draggable:!0,dragging_factor:.5,mobile_dragging_factor:1,touch_scroll_mode:"page_scroll_timer",page_scroll_timer_delay:1500,responsive_aspect:"width",on_fast_preload_finished:i,on_full_preload_finished:i,on_poster_load_finished:i},s="webex-spinner:";function i(){}class h{constructor(t){let{settings:i,data:h,update_image_cnt:e,get_frames_left:a}=t;this.t=i,this.i=h,this.h=e,this.o=a,this._=!1,this.l=!1,this.u=0,this.m=0,this.p=[],this.v=[],this.M=!1,this.q=0,this.T={images:this.t.images,event_fast:s+"fast-preload-finished",event_full:s+"full-preload-finished",callback_fast:this.t.on_fast_preload_finished,callback_full:this.t.on_full_preload_finished},this.k=this.i.num_frames,this.A=this.i.num_images}D(t){if(this._)return;t||(t=this.A),t=Math.round(t);const s=this.A-this.u;if(t>s&&(t=s),!(t<=0)){0===this.u&&(this.q=t);for(let s=this.u;s<this.u+t;++s){const t=this.T.images[s],i=new Image;i.j=0,i.C=t,i.onload=this.#t.bind(this),i.onerror=t=>{i.j<3?(i.j++,setTimeout((()=>{i.src=`${i.C}?_r=${Date.now()}`}),250*i.j)):this.#t(t)},i.src=t,this.p[s]=i}this.u=this.u+t}}#t(t){this.m++;const i=Math.floor(this.m/this.A*1e3)/1e3;if(this.i.canvas.element.dispatchEvent(new CustomEvent(s+"loading-progress",{detail:{progress:i}})),"error"===t.type){this.l=!0;const i=t.path||t.composedPath&&t.composedPath();this.v.push(i[0]),this.i.canvas.element.dispatchEvent(new Event(s+"loading-error"))}this.t.preload_amount>0&&this.m===this.q&&!this.M&&(this.M=!0,this.i.canvas.element.dispatchEvent(new Event(this.T.event_fast)),this.T.callback_fast(this.i.plugin_api)),this.m>=this.A&&(this.l&&this.#s(),this.#i())}#s(){this.v.length<1||(this.p=this.p.filter((t=>!this.v.includes(t))))}#i(){this._=!0,this.i.loaded_images_array=[...this.p],this.i.num_frames=this.p.length*(this.t.nx*this.t.ny),this.i.num_images=this.p.length,this.h();const t=this.i.plugin_api;this.i.deferred_action&&(this.i.deferred_action(),this.i.deferred_action=null),this.i.canvas.element.dispatchEvent(new Event(this.T.event_full)),this.T.callback_full(t)}}class e{constructor(t){let{settings:s,data:i}=t;this.t=s,this.i=i,this.F=this.i.canvas.element.getContext("2d")}H(t,s,i,h,e){void 0===s&&(s=0),void 0===i&&(i=0),void 0===h&&(h=1),void 0===e&&(e=1);const a=t.naturalWidth/h,r=t.naturalHeight/e,n=s*a,o=i*r,_={naturalWidth:a,naturalHeight:r,src:t.src,get I(){return t}};let l,d,u,c,g,m,f,p;({sx:l,sy:d,s_width:u,s_height:c,dx:g,dy:m,d_width:f,d_height:p}=this.#h(_)),this.F.drawImage(t,n+l,o+d,u,c,g,m,f,p)}N(){const t=this.i.canvas.element;this.F.clearRect(0,0,t.width,t.height)}#h(t){let s,i,h,e,a=this.i.canvas.element.width,r=this.i.canvas.element.height,n=t.naturalWidth,o=t.naturalHeight,_=Math.min(a/n,r/o),l=n*_,d=o*_,u=1;return l<a&&(u=a/l),Math.abs(u-1)<1e-14&&d<r&&(u=r/d),l*=u,d*=u,h=n/(l/a),e=o/(d/r),s=.5*(n-h),i=.5*(o-e),s<0&&(s=0),i<0&&(i=0),h>n&&(h=n),e>o&&(e=o),{sx:s,sy:i,s_width:h,s_height:e,dx:0,dy:0,d_width:a,d_height:r}}}class a{$;L;W;B;G;J;K;constructor(t){let{settings:s,data:i,change_frame:h}=t;this.t=s,this.i=i,this.O=h,this.G=!1,this.$=!1,this.J=0,this.K=.35,this.P()}R(){this.$=!0,this.G=!1,this.i.is_any_frame_changed||(this.O(1),Number.isFinite(this.L)&&this.L--),this.W=null,requestAnimationFrame(this.#e.bind(this))}S(){this.$=!1,this.L=void 0}U(t,s){void 0===s&&(s=void 0),t=Math.floor(t),void 0===s&&(s=this.t.reverse);let i=s?this.i.current_frame-t:this.i.current_frame+t;return this.t.loop?i<=0?i=this.i.num_frames-Math.abs(i):i>this.i.num_frames&&(i-=this.i.num_frames):i<=0?(i=1,this.G=!0):i>this.i.num_frames&&(i=this.i.num_frames,this.G=!0),i}#e(t){if(!this.$)return;let s;this.W||(this.W=performance.now());let i=Math.abs(t-performance.now())/this.B>this.K,h=(t-this.W)/this.B;if(h>this.K&&(i=!0),i?s=1:(h<0&&(h=0),s=h*this.i.num_frames,s+=this.J),s>=1){const h=i?performance.now():t;this.J=s%1,s=Math.floor(s)%this.i.num_frames,s>this.L&&(s=this.L);const e=this.U(s);this.G?(this.i.plugin_api.stop(),this.G=!1,this.i.plugin_api.get_current_frame()!==e&&this.O(e)):(this.W=h,this.O(e),void 0!==this.L&&(this.L=this.L-s,this.L<=0&&this.i.plugin_api.stop()))}this.$&&requestAnimationFrame(this.#e.bind(this))}P(){this.B=this.i.num_frames/this.t.fps*1e3}}class r{V;X;constructor(t){let{settings:s,data:i,draw_frame:h}=t;this.t=s,this.i=i,this.H=h,this.X=!1}Y(){this.t.poster&&!this.i.is_any_frame_changed&&(this.V=new Image,this.V.onload=this.V.onerror=this.#a.bind(this),this.V.src=this.t.poster)}Z(){!this.i.is_any_frame_changed&&this.X&&this.#r()}#a(t){"error"!==t.type&&(this.X=!0,this.t.on_poster_load_finished(this.i.plugin_api),this.i.is_any_frame_changed||this.#r())}#r(){this.H(this.V)}}class n{tt=!1;st;it;ht;et;rt;nt;ot;_t;lt;dt;ut;ct;constructor(t){let{data:s,settings:i,change_frame:h,get_next_frame:e}=t;this.i=s,this.t=i,this.O=h,this.U=e,this.gt=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"],this.tt=!1,this.ft=this.#n.bind(this),this.ut=!1,this.ct=!1,this.wt()}vt(){this.gt.forEach((t=>{this.i.canvas.element.addEventListener(t,this.ft)}))}yt(){this.gt.forEach((t=>{this.i.canvas.element.removeEventListener(t,this.ft)})),document.removeEventListener("mouseup",this.ft),document.removeEventListener("mousemove",this.ft),this.i.canvas.element.style.cursor=null}wt(t){void 0===t&&(t=null),this._t=t||this.i.canvas.element.clientWidth/this.i.num_frames}#o(){const t=this.t.dragging_factor,s=this.t.mobile_dragging_factor;return this.ut?t*s:t}#n(t){let s;switch(void 0!==t.touches&&t.touches.length&&(s=t.touches),this.st=s?s[0].pageX:t.clientX,this.it=s?s[0].pageY:t.clientY,t.type){case"mousedown":case"touchstart":this.ut="touchstart"===t.type,"touchstart"===t.type&&t.cancelable&&this.#_(t),document.addEventListener("mouseup",this.ft),document.addEventListener("mousemove",this.ft),this.#l();break;case"mousemove":case"touchmove":this.tt&&this.#d();break;case"mouseup":case"touchend":case"touchcancel":this.tt&&(document.removeEventListener("mouseup",this.ft),document.removeEventListener("mousemove",this.ft),this.#u())}}#l(){const t=this.i.plugin_api;t.is_preload_finished()&&(this.ct=t.is_running(),t.stop(),this.tt=!0,this.i.canvas.element.style.cursor="grabbing",this.ht=this.st,this.et=this.it,this.rt=this.i.current_frame,this.nt=this.st,this.ot=this.it)}#d(){const t=this.#c();this.dt=t;const s=(this.st-this.ht)/this.i.canvas.element.clientWidth*this.#o(),i=Math.round(s*this.i.num_frames);let h=this.rt-i;if(this.t.loop){for(;h<1;)h+=this.i.num_frames;for(;h>this.i.num_frames;)h-=this.i.num_frames}else h=Math.max(1,Math.min(this.i.num_frames,h));this.O(h),this.nt=this.st,this.ot=this.it}#u(){const t=this.st-this.ht<0?"left":"right";this.st=this.it=this.nt=this.ot=null,this.ht=this.et=this.rt=null,this.tt=!1,this.i.canvas.element.style.cursor=null,this.lt=(new Date).getTime();const s=this.i.plugin_api;(this.ct||this.t.autoplay)&&(s.set_reverse("right"===t),s.play()),this.ct=!1}#c(){let t,s,i=this.nt-this.st,h=this.ot-this.it;return t=Math.atan2(h,i),s=Math.round(180*t/Math.PI),s<0&&(s=360-Math.abs(s)),s>=0&&s<=60||s<=360&&s>=300?"right":s>=120&&s<=240?"left":s>=241&&s<=299?"bottom":"up"}#_(t){if("prevent_page_scroll"===this.t.touch_scroll_mode&&t.preventDefault(),"page_scroll_timer"===this.t.touch_scroll_mode){const s=(new Date).getTime();this.lt&&s-this.lt<this.t.page_scroll_timer_delay?t.preventDefault():this.lt=null}}}return class{#g;#m={current_frame:1,num_frames:null,num_images:null,loaded_images_array:[],deferred_action:null,is_any_frame_changed:!1,plugin_api:void 0,canvas:{element:null}};#f;#p;#w;#v;#y;#b;constructor(s,i){!function(t,s){if(!(t instanceof HTMLCanvasElement))throw new TypeError("node is required and should be canvas element");if(!s.images||!Array.isArray(s.images)||s.images.length<=1)throw new TypeError("options.images is required and must be an array with more than 1 element");"preload_amount"in s&&(s.preload_amount=Number.parseInt(s.preload_amount)),"dragging_factor"in s&&(s.dragging_factor=Math.abs(+s.dragging_factor))}(s,i),this.#g={...t,...i},this.#m.num_frames=this.#g.images.length*this.#g.nx*this.#g.ny,this.#m.num_images=this.#g.images.length,this.#m.plugin_api=this,this.#m.canvas.element=s,this.#f=this.#M.bind(this),this.#x()}#x(){this.#w=new e({settings:this.#g,data:this.#m}),this.#v=new a({settings:this.#g,data:this.#m,change_frame:this.#q.bind(this)}),this.#g.poster&&this.#E(),this.#M(!0),this.#p=new h({settings:this.#g,data:this.#m,update_image_cnt:this.#T.bind(this),get_frames_left:this.#k.bind(this)});const t=this.#g.preload_amount||this.#m.num_images;this.#p.D(t),this.#g.autoplay&&this.play(),this.#g.draggable&&this.#z(!0)}#q(t){t===this.#m.current_frame&&this.#m.is_any_frame_changed||(this.#m.is_any_frame_changed||(this.#m.is_any_frame_changed=!0),this.#A(t),this.#m.current_frame=t)}#A(t){this.#w.N();const{nx:s,ny:i}=this.#g,h=t-1,e=Math.floor(h/(s*i)),a=h%(s*i),r=a%s,n=Math.floor(a/s);this.#w.H(this.#m.loaded_images_array[e],r,n,s,i)}#T(){this.#b&&this.#b.wt(),this.#v.P()}#z(t){t?(this.#b||(this.#b=new n({data:this.#m,settings:this.#g,change_frame:this.#q.bind(this),get_next_frame:this.#v.U.bind(this.#v)})),this.#b.vt()):this.#b&&this.#b.yt()}#E(){this.#y||(this.#y=new r({settings:this.#g,data:this.#m,draw_frame:this.#w.H.bind(this.#w)})),this.#y.Y()}#M(t){void 0===t&&(t=!0),t?window.addEventListener("resize",this.#f):window.removeEventListener("resize",this.#f)}#k(){return this.#v.L}play(){return this.#v.$||(this.#p._?this.#v.R():(this.#m.deferred_action=this.play.bind(this),this.#p.D())),this}stop(){return this.#v.S(),this}set_reverse(t){return void 0===t&&(t=!0),this.#g.reverse=!!t,this}get_option(t){if(t in this.#g)return this.#g[t]}set_option(t,s){return["fps","loop","reverse","draggable","dragging_factor","touch_scroll_mode","page_scroll_timer_delay","on_full_preload_finished","on_poster_load_finished"].includes(t)&&(this.#g[t]=s,"fps"===t&&this.#v.P(),"draggable"===t&&this.#z(s),"dragging_factor"===t&&(this.#g.dragging_factor=Math.abs(+s))),this}get_current_frame(){return this.#m.current_frame}get_total_frames(){return this.#m.num_frames}get_total_images(){return this.#m.num_images}is_running(){return this.#v.$}is_dragging(){return!!this.#b&&this.#b.tt}is_preload_finished(){return this.#p._}is_loaded_with_errors(){return this.#p.l}swap_sequence(t,s,i,h){const e=this.#m.current_frame;this.stop(),this.#z(!1),this.#M(!1),this.#g.images=t,this.#g.nx=s,this.#g.ny=i,this.#g.poster=null,this.#m.num_images=t.length,this.#m.num_frames=t.length*s*i,this.#m.loaded_images_array=[],this.#m.is_any_frame_changed=!1,this.#m.deferred_action=null,this.#m.plugin_api=this;const a=this.#g.autoplay;this.#g.autoplay=!1,this.#x(),this.#g.autoplay=a;const r=Math.min(e,this.#m.num_frames);this.#m.deferred_action=()=>{a&&this.play(),this.#q(r)};const n=this.#g.preload_amount||this.#m.num_images,o=this.#m.num_images-n;o>0&&this.#p.D(o)}destroy(){this.stop(),this.#w.N(),this.#z(!1),this.#M(!1)}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).webex_spinner_c=s();
